Dear <%= @user.first_name %> <%= @user.last_name %>,

Here is a list of all your interations with betonmyself.com to date:

Purchase Transactions:
<% total_in = 0
   @user.transactions_in.sort {|a,b| a.created_at <=> b.created_at}.each do |o| 
   total_in = total_in + o.price
-%>
  $<%= @user.money_format(o.price) -%> on <%= o.created_at.strftime("%m/%d/%Y") %>
<% end -%>

Cash Out Transactions:
<% total_out = 0
   @user.transactions_out.sort {|a,b| a.created_at <=> b.created_at}.each do |o|
   total_out += o.price
-%>
   $<%= @user.money_format(o.price) -%> on <%= o.created_at.strftime("%m/%d/%Y") %>
<% end -%>

Current Goals:
<% total_current = 0
   @user.current_bets.sort {|a,b| a.due_date <=> b.due_date}.each do |o| 
   total_current = total_current + o.price
-%>
   "<%= o.descr -%>" to be completed by <%= o.due_date.strftime("%m/%d/%Y") %>
<% end -%>

Completed Goals:
<% @user.accomplishments.sort {|a,b| a.completion_date <=> b.completion_date}.each do |o| -%>
   "<%= o.descr -%>" was completed on <%= o.completion_date.strftime("%m/%d/%Y") %>
<% end -%>

Expired Goals:
<% total_expired = 0
   @user.failed_bets.sort {|a,b| a.due_date <=> b.due_date}.each do |o| 
   total_expired = total_expired + o.price
-%>
   "<%= o.descr -%>" expired on <%= o.due_date.strftime("%m/%d/%Y") %>
<% end -%>

Current Account Balance:
   Total In: $<%= @user.money_format(total_in) %>
   Total Out: $<%= @user.money_format(total_out) %>
   Total Expired: $<%= @user.money_format(total_expired) %>
   Account Total: $<%= @user.money_format(total_in - total_out - total_expired) %>
   Amount To Spend: $<%= @user.money_format(total_in - total_out - total_expired - total_current) %>
